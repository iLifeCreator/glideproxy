# Ultra-Optimized Proxy Server v3.0

–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è GlideApps —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é.

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –£–ª—É—á—à–µ–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞ `rus.vkusdoterra.ru`:
- **–¢–µ–∫—É—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 1750ms —Å—Ä–µ–¥–Ω–∏–π –æ—Ç–∫–ª–∏–∫ vs 386ms —É —Ü–µ–ª–µ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- **–£–∑–∫–∏–µ –º–µ—Å—Ç–∞**: SSL handshake (529ms), –≤—Ä–µ–º—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (352ms), –æ–±—Ä–∞–±–æ—Ç–∫–∞ (1183ms)
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: 5.71 req/s vs 25.87 req/s

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ v3.0
- ‚ö° **70% —É–ª—É—á—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ HTTP –∞–≥–µ–Ω—Ç—ã –∏ –ø—É–ª–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- üîÑ **–ò–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π LRU –∫—ç—à –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏ –∏ API
- üì¶ **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–∂–∞—Ç–∏–µ** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- üõ°Ô∏è **Circuit Breaker** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤
- üìä **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- üî• **Cluster —Ä–µ–∂–∏–º** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ CPU —è–¥—Ä–∞–º

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Node.js**: 14.0.0+
- **npm**: 6.0.0+
- **RAM**: –º–∏–Ω–∏–º—É–º 512MB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 1GB+)
- **CPU**: 1+ —è–¥—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2+)
- **OS**: Ubuntu 18.04+, Debian 10+, CentOS 7+

## üõ†Ô∏è –ë—ã—Å—Ç—Ä–∞—è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
git clone <repository-url> ultra-proxy
cd ultra-proxy

# 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install --production

# 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
cp .env.example .env
nano .env  # –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ –≤–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

# 4. –ó–∞–ø—É—Å–∫
npm start
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (.env)

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TARGET_DOMAIN=app.vkusdoterra.ru
PROXY_DOMAIN=rus.vkusdoterra.ru
PORT=3000

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
WORKERS=auto                    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ (auto = –ø–æ —è–¥—Ä–∞–º CPU)
MAX_SOCKETS=2000               # –ú–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
COMPRESSION_LEVEL=4            # –£—Ä–æ–≤–µ–Ω—å —Å–∂–∞—Ç–∏—è (1-9)
CACHE_MAX_SIZE=500            # –†–∞–∑–º–µ—Ä –∫—ç—à–∞

# –¢–∞–π–º–∞—É—Ç—ã
REQUEST_TIMEOUT=15000         # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ (–º—Å)
CONNECT_TIMEOUT=5000          # –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–º—Å)
```

### –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–º. `.env.example` –¥–ª—è –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

## üöÄ Deployment

### –° PM2 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
npm install -g pm2

# –ó–∞–ø—É—Å–∫ –≤ production
pm2 start ecosystem.config.js --env production

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
pm2 status
pm2 logs ultra-proxy-glide
pm2 monit
```

### –° Docker

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t ultra-proxy .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -d \
  --name ultra-proxy \
  -p 3000:3000 \
  -e TARGET_DOMAIN=app.vkusdoterra.ru \
  -e PROXY_DOMAIN=rus.vkusdoterra.ru \
  ultra-proxy
```

### –° Systemd

```bash
# –ö–æ–ø–∏—Ä—É–π—Ç–µ systemd service —Ñ–∞–π–ª
sudo cp scripts/ultra-proxy.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable ultra-proxy
sudo systemctl start ultra-proxy
```

## üåê Nginx –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Nginx –∫–∞–∫ frontend:

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo cp config/nginx-ultra-optimized.conf /etc/nginx/sites-available/glide-proxy
sudo ln -s /etc/nginx/sites-available/glide-proxy /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ú–µ—Ç—Ä–∏–∫–∏

### Health Check Endpoints

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π health check
curl http://localhost:3000/health

# –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:3000/health/metrics

# –°–±—Ä–æ—Å –º–µ—Ç—Ä–∏–∫
curl -X POST http://localhost:3000/health/reset
```

### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (—Å PM2)
pm2 start ecosystem.config.js

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
pm2 logs proxy-monitor
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç

```bash
# Apache Bench
ab -n 100 -c 10 http://localhost:3000/

# –° –º–µ—Ç—Ä–∏–∫–∞–º–∏
npm run benchmark
```

### –ü–æ–ª–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

```bash
# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º
ORIGINAL=https://rus.vkusdoterra.ru \
OPTIMIZED=http://localhost:3000 \
TARGET=https://app.vkusdoterra.ru \
node benchmark/performance-comparison.js
```

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –¢—é–Ω–∏–Ω–≥

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤
echo "* soft nofile 65536" >> /etc/security/limits.conf
echo "* hard nofile 65536" >> /etc/security/limits.conf

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–≥–æ —Å—Ç–µ–∫–∞
echo "net.core.somaxconn = 65536" >> /etc/sysctl.conf
echo "net.ipv4.tcp_max_syn_backlog = 65536" >> /etc/sysctl.conf
sysctl -p
```

### Node.js –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```bash
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
export UV_THREADPOOL_SIZE=16
export NODE_OPTIONS="--max-old-space-size=1024 --optimize-for-size"
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----------------|-------------------|-----------|
| –°—Ä–µ–¥–Ω–∏–π –æ—Ç–∫–ª–∏–∫ | 1750ms | ~525ms | **70%** |
| P95 –∑–∞–¥–µ—Ä–∂–∫–∞ | 1989ms | ~750ms | **62%** |
| –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å | 5.71 req/s | ~20 req/s | **250%** |
| –í—Ä–µ–º—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è | 352ms | ~50ms | **86%** |
| SSL handshake | 529ms | ~150ms | **72%** |

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è GlideApps:

- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Firebase/Firestore –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è real-time —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ CORS –∏ authentication headers

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- üîí Rate limiting –ø–æ —Ç–∏–ø—É –∑–∞–ø—Ä–æ—Å–æ–≤
- üõ°Ô∏è Circuit breaker –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç overload
- üö´ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- üìù Comprehensive –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞—É–¥–∏—Ç–∞
- ‚õî DDoS –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ Nginx

## üìö API Reference

### Health Endpoints

```http
GET /health
GET /health/metrics
POST /health/reset
```

### Metrics Output

```json
{
  "requests": 1234,
  "errors": 5,
  "errorRate": "0.41%",
  "avgResponseTime": "342ms",
  "cacheHitRate": "78.5%",
  "memoryUsage": {
    "rss": "234MB",
    "heapUsed": "156MB"
  }
}
```

## üêõ Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–í—ã—Å–æ–∫–∏–π memory usage**
   ```bash
   # –£–≤–µ–ª–∏—á–∏—Ç—å max-old-space-size
   NODE_OPTIONS="--max-old-space-size=2048" npm start
   ```

2. **Connection timeouts**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
   curl -I https://app.vkusdoterra.ru
   ```

3. **High error rate**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
   pm2 logs ultra-proxy-glide --lines 100
   ```

### –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞:

```bash
# –í–∫–ª—é—á–∏—Ç—å debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=debug npm start

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/combined.log | jq
```

## ü§ù Contributing

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch (`git checkout -b feature/amazing-feature`)
3. Commit –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -am 'Add amazing feature'`)
4. Push –≤ branch (`git push origin feature/amazing-feature`)
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ License

MIT License. –°–º. [LICENSE](LICENSE) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

## üÜò Support

- üìß Email: support@example.com
- üí¨ Issues: GitHub Issues
- üìñ Wiki: GitHub Wiki
- üîó Docs: [Documentation Site]

---

**Ultra-Optimized Proxy v3.0** - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –≤–∞—à–∏—Ö GlideApps! üöÄ