# üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º Enhanced Proxy v2.0

## üêõ –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ó–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü** - –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑-–∑–∞ –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ middleware
2. **–ü—É—Å—Ç—ã–µ —ç–∫—Ä–∞–Ω—ã –Ω–∞ /health endpoints** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥, proxy –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–ª health –∑–∞–ø—Ä–æ—Å—ã
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å POST/PUT –∑–∞–ø—Ä–æ—Å–∞–º–∏** - –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
4. **–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö** - –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ retry –ª–æ–≥–∏–∫–∞

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –≤–µ—Ä—Å–∏–∏ 2.1

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ—Ä—è–¥–æ–∫ middleware –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ connection pooling
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤ (ECONNRESET, ETIMEDOUT)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–æ—É—Ç–∏–Ω–≥ /health –∏ /health/detailed endpoints
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è POST/PUT
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ cookies —Å domain rewriting
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞–¥–µ–Ω–∏–π –ø—Ä–∏ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏—è—Ö
- ‚úÖ –£–ª—É—á—à–µ–Ω graceful shutdown
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üöÄ –°–ø–æ—Å–æ–±—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—á (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –°–∫–∞—á–∞–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ç—á
curl -sSL https://raw.githubusercontent.com/iLifeCreator/glideproxy/main/fix-proxy-v21.sh | sudo bash
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ù–∞–π–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π proxy
- –°–æ–∑–¥–∞—Å—Ç backup —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏
- –ü—Ä–∏–º–µ–Ω–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å
- –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

1. **–°–æ–∑–¥–∞–π—Ç–µ backup:**
```bash
cd /opt/your-proxy-name
cp -r src src-backup-$(date +%Y%m%d)
```

2. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é:**
```bash
curl -o src/app.js https://raw.githubusercontent.com/iLifeCreator/glideproxy/main/enhanced-proxy-v2-fixed.js
```

3. **–û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
```bash
npm install compression --save
```

4. **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ .env —Ñ–∞–π–ª
echo "LOG_REQUESTS=false" >> .env
echo "RETRY_ATTEMPTS=3" >> .env
echo "ENABLE_CACHING=true" >> .env
```

5. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:**
```bash
pm2 restart all
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ debug –≤–µ—Ä—Å–∏–∏

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é:

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ debug –≤–µ—Ä—Å–∏—é
curl -o /opt/debug-proxy.js https://raw.githubusercontent.com/iLifeCreator/glideproxy/main/simple-proxy-debug.js

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
PORT=3001 TARGET_DOMAIN=your-target.com node /opt/debug-proxy.js
```

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoints:

```bash
# –î–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å JSON, –∞ –Ω–µ –ø—É—Å—Ç—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
curl http://localhost:3000/health
curl http://localhost:3000/health/detailed
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "status": "healthy",
  "version": "2.1-fixed",
  "worker": 1,
  "timestamp": "2024-01-15T12:00:00.000Z"
}
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏:

```bash
# –ò–∑–º–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
time curl -I https://your-proxy.com

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å < 500ms –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
# –ò < 100ms –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö (–∫—ç—à)
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏:

```bash
pm2 logs --err --lines 50
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏:

```bash
curl http://localhost:3000/health | jq '.metrics'
```

## ‚öôÔ∏è –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–ª—è VPS —Å 2 CPU, 2GB RAM:

```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env
nano /opt/your-proxy/.env

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
WORKERS=2
MAX_MEMORY=400M
MAX_SOCKETS=1000
COMPRESSION_LEVEL=6
ENABLE_CACHING=true
CACHE_MAX_AGE=3600
```

### –î–ª—è VPS —Å 4+ CPU, 4GB+ RAM:

```bash
WORKERS=4
MAX_MEMORY=800M
MAX_SOCKETS=2000
COMPRESSION_LEVEL=3  # –ú–µ–Ω—å—à–µ CPU –Ω–∞ —Å–∂–∞—Ç–∏–µ
ENABLE_CACHING=true
CACHE_MAX_AGE=7200
```

## üîç –û—Ç–ª–∞–¥–∫–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ –≤—Å—ë –µ—â–µ –µ—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏:

1. **–í–∫–ª—é—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```bash
echo "LOG_REQUESTS=true" >> /opt/your-proxy/.env
pm2 restart all
pm2 logs
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ —Ü–µ–ª–µ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
ping -c 10 target-domain.com
traceroute target-domain.com
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ CPU:**
```bash
htop
pm2 monit
```

4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å —Å–∂–∞—Ç–∏–µ:**
```bash
echo "ENABLE_COMPRESSION=false" >> /opt/your-proxy/.env
pm2 restart all
```

### –ï—Å–ª–∏ health endpoints –≤—Å—ë –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ nginx –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç:**
```bash
# –í—Ä–µ–º–µ–Ω–Ω–æ –æ–±–æ–π–¥–∏—Ç–µ nginx
curl http://localhost:3000/health
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx:**
```bash
nginx -t
cat /etc/nginx/sites-enabled/your-proxy
```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ debug –≤–µ—Ä—Å–∏—é –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
```bash
node /opt/debug-proxy.js
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–∞—Ç—á–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ –ø–∞—Ç—á–∞ | –ü–æ—Å–ª–µ –ø–∞—Ç—á–∞ |
|---------|----------|-------------|
| –í—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –±–∞–π—Ç–∞ | 2-5 —Å–µ–∫ | < 500ms |
| Health endpoint | –ü—É—Å—Ç–æ–π —ç–∫—Ä–∞–Ω | JSON –æ—Ç–≤–µ—Ç |
| POST –∑–∞–ø—Ä–æ—Å—ã | –ú–æ–≥–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å | –†–∞–±–æ—Ç–∞—é—Ç |
| –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤ | –ù–µ—Ç | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ (3 –ø–æ–ø—ã—Ç–∫–∏) |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ |

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup:

```bash
# –ï—Å–ª–∏ –ø–∞—Ç—á —Å–æ–∑–¥–∞–ª backup
cd /opt/your-proxy
rm -rf src
cp -r backup-*/src ./
pm2 restart all
```

### –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞:

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp /opt/your-proxy/.env ~/proxy-config-backup.env

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
curl -sSL https://raw.githubusercontent.com/iLifeCreator/glideproxy/main/enhanced-installer-v2.sh | sudo bash

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp ~/proxy-config-backup.env /opt/your-proxy/.env
pm2 restart all
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:

1. –°–æ–±–µ—Ä–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
```bash
pm2 status > diagnostics.txt
pm2 info your-proxy >> diagnostics.txt
curl http://localhost:3000/health >> diagnostics.txt
pm2 logs --nostream --lines 100 >> diagnostics.txt
```

2. –°–æ–∑–¥–∞–π—Ç–µ issue –Ω–∞ GitHub: https://github.com/iLifeCreator/glideproxy/issues

---

**Enhanced Proxy v2.1** - –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã! üéâ